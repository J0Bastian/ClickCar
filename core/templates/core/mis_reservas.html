{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mis Reservas - ClickCar</title>
    <link rel="stylesheet" href="{% static 'css/estilos.css' %}">

    <style>
        .reserva-card {
            display: flex;
            background: #fff;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,.12);
            align-items: center;
            gap: 20px;
        }

        .reserva-img-box img {
            border-radius: 12px;
            box-shadow: 0 3px 6px rgba(0,0,0,.2);
        }

        .estado.confirmada { color: #0fa81d; font-weight:bold; }
        .estado.cancelada { color: #b30000; font-weight:bold; }
        .estado.pendiente { color: #d5a200; font-weight:bold; }

        .reserva-info h3 {
            margin: 0;
        }
    </style>
</head>

<body>

<header>
    <nav>
        <div class="logo">
            <a href="{% url 'home' %}">
               <img src="{% static 'img/LogoClickCar.png' %}" alt="Logo ClickCar">
            </a>
        </div>

        <ul class="menu">
            <li><a href="{% url 'home' %}">Inicio</a></li>
            <li><a href="{% url 'products' %}">Vehiculos</a></li>

            <li><a href="{% url 'perfil_usuario' request.session.usuario_id %}">Mi Perfil</a></li>

            <li><a href="{% url 'exit' %}">Salir</a></li>
        </ul>
    </nav>
</header>

<!-- MENSAJES PARA MIS RESERVAS -->
{% if messages %}
<div class="messages-container">
    {% for message in messages %}
        {% if 'mis_reservas' in message.tags %}
            <div class="msg {{ message.tags }}">{{ message }}</div>
        {% endif %}
    {% endfor %}
</div>
{% endif %}

<section class="mis-reservas-container">

    <h2 class="titulo-seccion">Mis Reservas</h2>

    {% if reservas %}
        <div class="lista-reservas">

            {% for r in reservas %}
            <div class="reserva-card">

                <!-- FOTO REAL O PLACEHOLDER -->
                <div class="reserva-img-box">
                    {% if r.auto.foto %}
                        <img src="{{ r.auto.foto.url }}"
                             alt="Vehículo"
                             width="180" height="120"
                             style="object-fit:cover;">
                    {% else %}
                        <img src="{% static 'img/car_default.png' %}"
                             alt="Vehículo"
                             width="180" height="120"
                             style="object-fit:cover; opacity:0.6;">
                    {% endif %}
                </div>

                <!-- INFO -->
                <div class="reserva-info">
                    <h3>{{ r.auto.marca }} {{ r.auto.modelo }}</h3>

                    <p><strong>Estado:</strong> 
                        <span class="estado {{ r.estado }}">{{ r.estado|capfirst }}</span>
                    </p>

                    <p><strong>Inicio:</strong> {{ r.fecha_inicio }}</p>
                    <p><strong>Fin:</strong> {{ r.fecha_fin }}</p>

                    <p class="precio"><strong>Total:</strong> ${{ r.valor_total }}</p>

                    <!-- VER DETALLE -->
                    <a href="{% url 'detalle_reserva' r.id_reserva %}" class="btn-ver">
                        Ver detalles
                    </a>

                    <!-- CANCELAR SI AÚN NO ESTÁ CANCELADA -->
                    {% if r.estado != "cancelada" %}
                    <form action="{% url 'cancelar_reserva' r.id_reserva %}" 
                          method="POST" 
                          onsubmit="return confirm('¿Seguro que deseas cancelar esta reserva?');">
                        {% csrf_token %}
                        <button type="submit" class="btn-delete"
                                style="background:#ff4444; color:white; margin-top:10px;">
                            Cancelar Reserva
                        </button>
                    </form>
                    {% endif %}
                </div>

            </div>
            {% endfor %}

        </div>
    {% else %}
        <p class="no-reservas">No tienes reservas registradas.</p>
    {% endif %}

</section>

</body>
</html>
